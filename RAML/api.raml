#%RAML 1.0

# TODO: XML support? YAML support?
# TODO: use something other than localhost?
# TODO: HTTPS

title: Library App
description: >
  An app for a school (and possibly general) library. Currently in the early
  development/design stages, will change a lot.
version: v0
baseUri: /{version}
mediaType: application/json
uses:
  marc: marc.raml
  basic: basic.raml
securitySchemes:
  oauth2:
    type: OAuth 2.0
    description: >
      OAuth 2.0 is used for all requests that require authentication.
    describedBy:
      headers:
        Authorization:
          description: >
            Used to send a valid OAuth 2.0 access token. Incompatible with the
            "access_token" query parameter.
          type: string
      queryParameters:
        access_token:
          description: >
            Used to send a valid OAuth 2.0 access token. Incompatible with the
            "Authorization" HTTP header.
          type: string
      responses:
        401: # Unauthorized
          description: >
            The client is not authorized to perform the request (i.e., not
            logged in). Perform authentication, then try again.
        403:
          description: >
            The client is logged in, but does not have the requisite permissions
            to perform the request.
    settings:
      authorizationUri: http://localhost:8080/{version}/oauth2/authorize
      accessTokenUri: http://localhost:8080/{version}/oauth2/token
      authorizationGrants:
        - authorization_code # TODO implicit too?
    scopes:
      - item.read
      - item.write
      - patron.read
      - patron.write
      - checkout.read
      - checkout.write
      - signOut
      - signIn
      - admin.read
      - admin.write
types:
  Item:
    type: object
    description: >
      An object representing an item in the system. Items can be checked out and
      in, and can be any kind of item, like books, maps, audio files, etc. All
      bibliographic information is specified through MARC records. Anything not
      in the `marc` property is information additional to MARC.
    # TODO Should there be some properties duplicating info in the MARC record
    # for easier access?
    # TODO Should the if-then nature of the checkout property be expressed more?
    properties:
      marc: marc.MARCRecord
      created: datetime
      barcode:
        type: string
        pattern: ^\d+$
      status:
        type: string
        enum:
          - in
          - out
          - missing
          - lost
      checkout?: Checkout # Not present if in Checkout or not applicable
    additionalProperties: false
  Checkout:
    type: object
    description: >
      An object representing a checkout of an item. Contains information
      relevant only to checking out, but not to the item, hence the separate
      object.
    properties:
      item?: Item # Not present if in Item; TODO show this
      patron?: Patron # Not present if in Patron
      outDate: date-only
      dueDate: date-only
      numRenewals: integer
      status:
        type: string
        enum:
          - onTime
          - late
          - returned
          - lost
    additionalProperties: false
  Patron:
    type: object
    description: >
      An object representing a patron of the library. Patrons may have items
      checked out in their name.
    properties:
      name: string
      pic:
        # TODO Can the media type of image/whatever be noted?
        type: basic.uri
        default: http://localhost:8080/missing-pic.png # TODO proper missing pic
      checkouts: Checkout[]
    additionalProperties: false
  ReadWritePermission:
    type: object
    description: >
      An object representing an admin's permissions to read or write something.
    properties:
      read: boolean
      write: boolean
    additionalProperties: false
  Admin:
    type: object
    description: >
      An object representing an admin in the library. This could be a librarian,
      IT person, volunteer, or anyone who needs read or write access to the
      library. An admin has a set of permissions that correspond with OAuth
      scopes.
    # TODO permissions will be duplicated here and in the security schemes --
    # combine somehow?
    # TODO should signOut/signIn (a) be capitalized and (b) be somehow put under
    # the checkout object? Implement with separate CRUD permissions?
    properties:
      item: ReadWritePermission
      patron: ReadWritePermission
      checkout: ReadWritePermission
      signOut:
        type: boolean
        description: >
          An admin with this permission can check out an item on behalf of a
          Patron. Note that this permission is different than checkout/write, as
          that permission also implies the ability to update/delete existing
          checkouts.
      signIn:
        type: boolean
        description: >
          An admin with this permission can check in an item on behalf of a
          Patron. Note that this permission is different than checkout/write, as
          that permission also implies the ability to update/delete existing
          checkouts.
      admin: ReadWritePermission
    additionalProperties: false